{% extends "pages/index.html" %}
<!-- Main page content-->
{% block content %}
<main style="position:relative">
    <!-- Overlay controls (now the source of truth) -->
    <script>
        // Provide initial stages to the overlay script
        window.__STAGES__ = [
            {% for stage in stages %}
            {"code": "{{stage.code}}", "status": "{{stage.status}}"}{{ "," if not loop.last else "" }}
            {% endfor %}
        ];
    </script>

    {% include "components/flight_controls.html" %}
  
    <!-- Keep the viewer iframe for now (gzweb now; replace with your map later) -->
    <iframe id="sim-iframe" src="http://localhost:8080" style="width: 100%; height: 100vh; border:0;"></iframe>
  </main>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        if (window.location.hostname !== 'localhost') {
            Swal.fire({
                title: "Access Alert",
                text: "You are not accessing the application from the standard 'localhost' origin. Would you like to redirect to the correct origin?",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                confirmButtonText: "Redirect",
                cancelButtonText: "Stay here"
            }).then((result) => {
                if (result.isConfirmed) {
                    // Redirect to the localhost origin
                    // Change the port as needed if it's not the default HTTP 80
                    window.location.hostname = 'localhost';
                }
            });
        }
    });
    // wait for 1 second before sending the message to the iframe
    setTimeout(function () {
    var iframeWindow = document.getElementById("sim-iframe").contentWindow;
    if (iframeWindow) {
        {% for stage in stages %}
            iframeWindow.postMessage("set-{{stage.code}}-{{stage.status.lower()}}", "http://localhost:8080");
        {% endfor %}
    }
    }, 1000);

</script>

{% endblock %}
