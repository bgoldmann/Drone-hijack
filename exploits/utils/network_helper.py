#!/usr/bin/env python3
"""
Network Helper Utilities
Common network functions for exploitation
"""

import socket
import subprocess
import re
from typing import List, Optional

def get_interface_ip(interface: str) -> Optional[str]:
    """
    Get IP address of network interface
    
    Args:
        interface: Network interface name
    
    Returns:
        IP address or None
    """
    try:
        result = subprocess.run(['ip', 'addr', 'show', interface], 
                              capture_output=True, text=True, check=True)
        match = re.search(r'inet (\d+\.\d+\.\d+\.\d+)', result.stdout)
        if match:
            return match.group(1)
    except Exception:
        pass
    return None

def scan_ports(ip: str, ports: List[int], timeout: float = 1.0) -> List[int]:
    """
    Scan for open ports on target IP
    
    Args:
        ip: Target IP address
        ports: List of ports to scan
        timeout: Connection timeout
    
    Returns:
        List of open ports
    """
    open_ports = []
    
    for port in ports:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(timeout)
        result = sock.connect_ex((ip, port))
        sock.close()
        
        if result == 0:
            open_ports.append(port)
    
    return open_ports

def get_mac_address(ip: str) -> Optional[str]:
    """
    Get MAC address for IP using ARP table
    
    Args:
        ip: IP address
    
    Returns:
        MAC address or None
    """
    try:
        result = subprocess.run(['arp', '-n', ip], 
                              capture_output=True, text=True, check=True)
        match = re.search(r'([0-9a-f]{2}[:-]){5}[0-9a-f]{2}', result.stdout, re.IGNORECASE)
        if match:
            return match.group(0)
    except Exception:
        pass
    return None

def enable_monitor_mode(interface: str) -> Optional[str]:
    """
    Enable monitor mode on interface
    
    Args:
        interface: Network interface name
    
    Returns:
        Monitor mode interface name or None
    """
    try:
        # Try airmon-ng
        result = subprocess.run(['airmon-ng', 'start', interface], 
                              capture_output=True, text=True, check=True)
        # Extract monitor interface from output
        match = re.search(r'monitor mode enabled on (\w+)', result.stdout)
        if match:
            return match.group(1)
    except Exception:
        pass
    
    # Fallback: try iw
    try:
        subprocess.run(['iw', 'dev', interface, 'set', 'type', 'monitor'], 
                      check=True, capture_output=True)
        return interface + 'mon'
    except Exception:
        pass
    
    return None
